---
phase: 04-cli-interface
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/cli/commands/list_cmd.py
  - src/cli/commands/show.py
  - src/cli/commands/delete.py
  - src/cli/__init__.py
autonomous: true

must_haves:
  truths:
    - "User can run 'graphiti list' and see entities in table format"
    - "User can run 'graphiti show entity_name' and see full entity details with relationships"
    - "User can run 'graphiti delete entity1 entity2' and gets confirmation prompt"
    - "Delete with --force skips confirmation"
    - "Ambiguous entity names prompt user to choose"
    - "--format json works for all three commands"
    - "--compact shows one-line-per-result for list"
  artifacts:
    - path: "src/cli/commands/list_cmd.py"
      provides: "List command showing entities with filtering"
      exports: ["list_command"]
    - path: "src/cli/commands/show.py"
      provides: "Show command displaying full entity details with relationships"
      exports: ["show_command"]
    - path: "src/cli/commands/delete.py"
      provides: "Delete command with confirmation prompt, bulk delete, --force"
      exports: ["delete_command"]
  key_links:
    - from: "src/cli/commands/delete.py"
      to: "src/cli/utils.py"
      via: "confirm_action for destructive operation confirmation"
      pattern: "confirm_action"
    - from: "src/cli/commands/list_cmd.py"
      to: "src/cli/output.py"
      via: "print_table, print_compact for result display"
      pattern: "print_table|print_compact"
    - from: "src/cli/commands/show.py"
      to: "src/cli/output.py"
      via: "console.print for rich entity detail rendering"
      pattern: "console\\.print"
---

<objective>
Implement list, show, and delete CLI commands. List displays entities in a table. Show provides detailed view of a single entity with relationship information. Delete handles destructive operations with confirmation prompts and bulk delete support.

Purpose: List and show are the primary browsing commands. Delete is the first destructive command requiring confirmation UX. Together they complete the read+delete CRUD operations.

Output: Working `graphiti list`, `graphiti show`, and `graphiti delete` commands registered with the Typer app.
</objective>

<execution_context>
@/home/tasostilsi/.claude/get-shit-done/workflows/execute-plan.md
@/home/tasostilsi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-cli-interface/04-CONTEXT.md
@.planning/phases/04-cli-interface/04-RESEARCH.md
@.planning/phases/04-cli-interface/04-01-SUMMARY.md
@src/cli/__init__.py
@src/cli/output.py
@src/cli/utils.py
@src/storage/graph_manager.py
@src/storage/selector.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement list and show commands</name>
  <files>
    src/cli/commands/list_cmd.py
    src/cli/commands/show.py
  </files>
  <action>
Create `src/cli/commands/list_cmd.py` (named list_cmd to avoid shadowing Python's `list` builtin):

Function signature:
```
def list_command(
    global_scope: Annotated[bool, typer.Option("--global", "-g", help="List from global scope")] = False,
    project_scope: Annotated[bool, typer.Option("--project", "-p", help="List from project scope")] = False,
    type_filter: Annotated[Optional[str], typer.Option("--type", help="Filter by type: entity, relationship")] = None,
    tag: Annotated[Optional[list[str]], typer.Option("--tag", "-t", help="Filter by tag")] = None,
    limit: Annotated[int, typer.Option("--limit", "-l", help="Max items to show")] = DEFAULT_LIMIT,
    all_results: Annotated[bool, typer.Option("--all", help="Show all items")] = False,
    compact: Annotated[bool, typer.Option("--compact", "-c", help="One-line-per-item view")] = False,
    format: Annotated[Optional[str], typer.Option("--format", "-f", help="Output format: json")] = None,
)
```

Implementation:
1. Resolve scope. Determine effective limit (None if --all).
2. Spinner: `console.status("Loading entities...")`.
3. Call stub `_list_entities()` returning mock entity list (5-8 items with name, type, created_at, tags, scope, relationship_count fields).
4. If empty: print_warning("No entities found.") and exit 0.
5. Output: format=="json" -> print_json. compact -> print_compact. default -> print_table with columns [Name, Type, Tags, Relations, Created].
6. Print count: "{N} entities" or "{N} of {total} entities".

Create `src/cli/commands/show.py`:

Function signature:
```
def show_command(
    entity: Annotated[str, typer.Argument(help="Entity name or ID")],
    global_scope: Annotated[bool, typer.Option("--global", "-g")] = False,
    project_scope: Annotated[bool, typer.Option("--project", "-p")] = False,
    format: Annotated[Optional[str], typer.Option("--format", "-f", help="Output format: json")] = None,
)
```

Implementation:
1. Resolve scope.
2. Call stub `_find_entity(entity)` that returns mock entity data OR list of matches for ambiguous names.
3. If not found: print_error(f"Entity '{entity}' not found.", suggestion="Try 'graphiti list' to see available entities.") and exit EXIT_ERROR.
4. If multiple matches (ambiguous): display numbered list using Rich, prompt user to choose with `typer.prompt("Select entity [1-{n}]")`. This implements the "prompt on ambiguity" per CONTEXT.md.
5. Display entity detail using Rich panels/formatting:
   - Entity name as title (bold cyan).
   - Type, scope, created_at, updated_at fields.
   - Tags displayed as comma-separated.
   - Content/description.
   - Relationships section: list each relationship with type and target entity name.
6. format=="json": print_json of full entity dict including relationships.
  </action>
  <verify>
Run: `python -c "from src.cli.commands.list_cmd import list_command; print(list_command.__name__)"` should print "list_command".
Run: `python -c "from src.cli.commands.show import show_command; print(show_command.__name__)"` should print "show_command".
  </verify>
  <done>
list_command shows entities in table/compact/json format with filtering. show_command displays full entity details with relationships. Ambiguous entity names prompt user selection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement delete command and register list/show/delete with app</name>
  <files>
    src/cli/commands/delete.py
    src/cli/__init__.py
  </files>
  <action>
Create `src/cli/commands/delete.py`:

Function signature:
```
def delete_command(
    entities: Annotated[list[str], typer.Argument(help="Entity names or IDs to delete")],
    force: Annotated[bool, typer.Option("--force", "-f", help="Skip confirmation prompt")] = False,
    global_scope: Annotated[bool, typer.Option("--global", "-g")] = False,
    project_scope: Annotated[bool, typer.Option("--project", "-p")] = False,
    format: Annotated[Optional[str], typer.Option("--format", "-f", help="Output format: json")] = None,
    quiet: Annotated[bool, typer.Option("--quiet", "-q", help="Suppress output")] = False,
)
```

NOTE: There is a flag conflict with `-f` for both `--force` and `--format`. Use `-F` for force OR remove the short flag from one. Per CONTEXT.md, `--force` is the important one. So: `--force/-f` keeps `-f`, and `--format` gets no short flag (or uses `--format` only, consistent with other commands using `--format` without short flag in some CLIs). Actually, looking at the CONTEXT.md, the format flag is `--format json` (no short). The RESEARCH.md uses `-f` for format. Resolve: use `--force` with no short flag alias to avoid conflict, since `--format` is used across all commands and `-f` is more natural for format. Wait -- actually, the research shows `--format, "-f"` for format and `--force, "-f"` for force. This IS a conflict. Resolution: `--force` gets no short alias (destructive ops should be explicit), `--format` gets `-f` short alias (used frequently across all commands for consistency).

Corrected signature:
```
    force: Annotated[bool, typer.Option("--force", help="Skip confirmation prompt")] = False,
```

Implementation:
1. Resolve scope.
2. For each entity name, resolve to actual entity (stub `_resolve_entity(name)` returns mock entity or None or list for ambiguous).
3. Collect resolved entities. If any not found, print_error and exit EXIT_ERROR.
4. If ambiguous matches exist, prompt user to choose (same pattern as show).
5. If not force: display what will be deleted using Rich table (Name, Type, Scope), then call `confirm_action(f"Delete {len(entities)} entities?", force=force)`. If user declines, print "Cancelled" and exit 0.
6. Spinner: `console.status(f"Deleting {len(resolved)} entities...")`.
7. Call stub `_delete_entities(resolved)` returning count deleted.
8. Output: format=="json" -> print_json({"deleted": count, "entities": [names]}). Not quiet -> print_success(f"Deleted {count} entities").
9. Proper exit codes: EXIT_SUCCESS on success.

Update `src/cli/__init__.py` to register all three new commands:
- `app.command(name="list", help="List entities in the knowledge graph")(list_command)`
- `app.command(name="show", help="Show detailed entity information")(show_command)`
- `app.command(name="delete", help="Delete entities from the knowledge graph")(delete_command)`

Import from respective modules.
  </action>
  <verify>
Run: `python -c "from typer.testing import CliRunner; from src.cli import app; r = CliRunner(); result = r.invoke(app, ['--help']); print('list' in result.output and 'show' in result.output and 'delete' in result.output)"` should print True.
Run: `python -c "from typer.testing import CliRunner; from src.cli import app; r = CliRunner(); result = r.invoke(app, ['delete', 'test_entity', '--force']); print(result.exit_code)"` should print 0 (with mock data).
  </verify>
  <done>
delete_command supports bulk entity deletion with confirmation prompt (--force to skip), ambiguous name resolution, JSON/quiet output modes. All three commands (list, show, delete) registered with app and visible in --help.
  </done>
</task>

</tasks>

<verification>
- `graphiti list --help` shows all filter and format options
- `graphiti show --help` shows entity argument and scope flags
- `graphiti delete --help` shows entities argument, --force, scope flags
- All three commands appear in `graphiti --help` output
- Delete prompts for confirmation without --force
- Delete proceeds silently with --force
</verification>

<success_criteria>
1. `graphiti list` shows entities in table format with columns
2. `graphiti list --compact` shows one-line-per-entity
3. `graphiti list --format json` outputs JSON array
4. `graphiti show entity_name` displays rich entity detail with relationships
5. `graphiti show` with ambiguous name prompts user to choose
6. `graphiti delete entity1 entity2` prompts for confirmation
7. `graphiti delete --force entity1` skips confirmation
8. `graphiti delete --format json` outputs JSON with deletion summary
9. All commands respect --global/--project scope flags
</success_criteria>

<output>
After completion, create `.planning/phases/04-cli-interface/04-03-SUMMARY.md`
</output>
