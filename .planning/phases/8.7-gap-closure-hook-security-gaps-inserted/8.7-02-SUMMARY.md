---
phase: 8.7-gap-closure-hook-security-gaps-inserted
plan: "02"
subsystem: hooks
tags: [git-hooks, pre-commit, secret-scanning, cli]

# Dependency graph
requires:
  - phase: 7.1-git-indexing-pivot
    provides: install_precommit_hook, uninstall_precommit_hook, is_precommit_hook_installed in installer.py
  - phase: 06-automatic-capture
    provides: hooks CLI command group (hooks_app with install/uninstall/status subcommands)
provides:
  - graphiti hooks install now deploys all 5 hooks (pre-commit wired in)
  - graphiti hooks uninstall removes pre-commit hook
  - graphiti hooks status shows Git pre-commit row in table and JSON output
affects: [8.7-03, phase-09, phase-10]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Pre-commit hook deployed via install_precommit_hook(root, force=force) — root is repo_path (not git_dir)
    - Uninstall via uninstall_precommit_hook(root) symmetric with install
    - Status check via is_precommit_hook_installed(root) — renders Git pre-commit row first in table

key-files:
  created: []
  modified:
    - src/cli/commands/hooks.py

key-decisions:
  - "Pass root (repo_path) not git_dir to pre-commit functions — install_precommit_hook takes repo_path, not .git dir (unlike post-checkout/post-rewrite which take git_dir)"
  - "Pre-commit row placed first in status table — secret-scanning is the primary security gate, ordering emphasizes importance"
  - "install_precommit_hook respects --force flag — pass force=force so user can force-reinstall the pre-commit hook"
  - "Uninstall is non-destructive — graphiti section removed from pre-commit file, template header stub remains (consistent with all other hooks)"

patterns-established:
  - "All hook install/uninstall/status functions must be wired symmetrically — every install needs matching uninstall + status check"

requirements-completed: []

# Metrics
duration: 2min
completed: 2026-02-27
---

# Phase 8.7 Plan 02: Wire install_precommit_hook into CLI Commands Summary

**Pre-commit hook (secret scanning + size checks) wired into graphiti hooks install/uninstall/status — all 5 git hooks now fully deployed from a single CLI command**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-27T16:25:26Z
- **Completed:** 2026-02-27T16:27:32Z
- **Tasks:** 7 (tasks 1-2 read/analysis, 3-6 code changes, 7 test run)
- **Files modified:** 1

## Accomplishments

- `graphiti hooks install` now calls `install_precommit_hook(root, force=force)` deploying the pre-commit secret-scanning hook
- `graphiti hooks uninstall` now calls `uninstall_precommit_hook(root)` removing the graphiti pre-commit section
- `graphiti hooks status` now shows "Git pre-commit" row (first row) with correct installed/not-installed indicator
- `graphiti hooks status --format json` includes `precommit_installed` key
- All 197 existing tests pass with no regressions
- CLI install output updated from "pre-commit, post-commit..." (false claim) to "All 5 hooks deployed: pre-commit, post-commit, post-merge, post-checkout, post-rewrite" (accurate)

## Task Commits

Each task was committed atomically:

1. **Tasks 1-7: Wire pre-commit hook into CLI install/uninstall/status** - `19ac3f2` (fix)

**Plan metadata:** (docs commit — see below)

## Files Created/Modified

- `src/cli/commands/hooks.py` - Added install_precommit_hook, uninstall_precommit_hook, is_precommit_hook_installed imports; wired all three into install_command, uninstall_command, status_command

## Decisions Made

- Pass `root` (not `git_dir`) to pre-commit functions — the `install_precommit_hook` / `uninstall_precommit_hook` / `is_precommit_hook_installed` functions take `repo_path` (the repository root), not the `.git` directory. This is different from post-checkout and post-rewrite which take `git_dir`. Checked function signatures in installer.py lines 478-512.
- Pre-commit row placed first in status table — secret-scanning is the primary security gate, so it deserves top position in the hook status display.
- Corrected misleading success message — the old message claimed "All indexer hooks deployed: pre-commit, post-commit..." but pre-commit was not actually being installed. Corrected to "All 5 hooks deployed: pre-commit, post-commit, post-merge, post-checkout, post-rewrite" which is now accurate.
- Plan verification note — the plan expected `ls .git/hooks/pre-commit` to show "removed" after uninstall, but the template has a header outside the markers. The graphiti section is correctly removed (is_precommit_hook_installed returns False), but the file stub with shebang + comment header remains. This is consistent non-destructive behavior with all other hooks.

## Deviations from Plan

None — plan executed exactly as written. The plan correctly identified all three files/functions to change and the exact API to use.

## Issues Encountered

None — the installer functions (`install_precommit_hook`, `uninstall_precommit_hook`, `is_precommit_hook_installed`) all existed in `installer.py` as expected. No missing imports, no broken types.

One minor clarification: the plan suggested checking if `is_precommit_hook_installed` exists "or implement the check inline" — it already existed at line 491. No implementation needed.

## User Setup Required

None — no external service configuration required. The pre-commit hook is automatically deployed on next `graphiti hooks install`.

## Next Phase Readiness

- Plan 8.7-02 complete — pre-commit hook now properly deployed via CLI
- Plan 8.7-03 (update verify scripts) is the final plan in Phase 8.7
- After Phase 8.7 complete, Phase 9 (Advanced Features) can begin

---
*Phase: 8.7-gap-closure-hook-security-gaps-inserted*
*Completed: 2026-02-27*
