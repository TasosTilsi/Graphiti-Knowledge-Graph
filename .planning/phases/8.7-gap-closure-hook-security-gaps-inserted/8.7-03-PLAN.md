---
plan: 8.7-03
phase: 8.7-gap-closure-hook-security-gaps-inserted
title: Update verification scripts to test fixed behaviour
status: pending
created: 2026-02-27
depends_on: [8.7-01, 8.7-02]
---

# Plan 8.7-03: Update Verification Scripts for Fixed Behaviour

## Objective

Update `scripts/verify_phase_07.py` and `scripts/verify_phase_71.py` to test the
behaviour fixed in Plans 8.7-01 and 8.7-02. Both scripts currently work around the
bugs; they should now directly verify the correct behaviour.

## Changes Required

### scripts/verify_phase_07.py — Test 2

**Current**: Test 2 uses a modified existing file (two commits: clean version → add secret)
because new staged files were silently skipped.

**After 8.7-01 fix**: Test 2 should ALSO test a brand-new staged file (no initial commit),
confirming the fix works.

Add a sub-test to Test 2:
```python
# Sub-test: brand-new file (not previously in HEAD) — tests the 8.7-01 fix
new_file = tmp_root / "new_secrets.py"
new_file.write_text("TOKEN = 'AKIAIOSFODNN7EXAMPLE'\n")
run(["git", "add", "new_secrets.py"], cwd=tmp_root)
new_file_warnings = scan_staged_secrets(tmp_root)
if new_file_warnings:
    r.ok("New staged file (not in HEAD) — secrets detected (8.7-01 fix confirmed)")
else:
    r.fail("New staged file not scanned — 8.7-01 fix not applied")
```

Also remove the explanatory note about the limitation since it's now fixed.

### scripts/verify_phase_71.py — Test 1 & 2

**Current**: Tests check 4 auto-installed hooks; documents pre-commit as NOT auto-installed.

**After 8.7-02 fix**: `graphiti hooks install` should deploy all 5 hooks.

Update Test 1 header from "deploys all 5 hooks" (which was aspirational) to actually
verify 5 hooks.

Update Test 2:
- Change `auto_installed_hooks = [...]` to include `"pre-commit"`
- Remove the special-case block that says pre-commit is not auto-installed
- Simply check all 5 hooks exist and are executable

Update summary messaging to reflect 5 hooks.

## Tasks

1. Read current `scripts/verify_phase_07.py` Test 2 (lines ~65–110)
2. Add sub-test for brand-new staged file; remove the limitation note
3. Read current `scripts/verify_phase_71.py` Tests 1–2 (lines ~80–140)
4. Update `auto_installed_hooks` to 5 entries; remove pre-commit special-case block
5. Run both scripts to confirm they pass:
   ```bash
   python scripts/verify_phase_07.py
   python scripts/verify_phase_71.py --skip-ollama
   ```

## Verification

Both scripts should pass with 0 failures:
- `verify_phase_07.py`: Test 2 now has a new-file sub-test passing
- `verify_phase_71.py`: Test 2 shows 5 hooks installed and executable

## Commit Message

```
test(verify): update 07+71 scripts to confirm 8.7-01/02 fixes

verify_phase_07.py Test 2 now tests new staged file detection.
verify_phase_71.py Tests 1+2 now expect all 5 hooks from hooks install.
```
