---
plan: 8.9-02
phase: 08.9-gap-closure-integration-wiring-fixes-inserted
status: complete
completed: "2026-03-01"
requirements-completed:
  - R3.3
  - R4.1
key-files:
  created: []
  modified:
    - src/hooks/manager.py
---

# Summary: Plan 8.9-02 — Fix hooks.enabled CLI Syntax and _is_claude_hook_installed() Traversal

## What Was Built

Fixed two bugs in `src/hooks/manager.py`:

1. **CLI flag syntax fix**: `get_hooks_enabled()` and `set_hooks_enabled()` were using invalid `--get`/`--set` flags causing silent failures. Fixed to use correct subcommand syntax: `graphiti config get hooks.enabled` and `graphiti config set hooks.enabled <value>`.

2. **Dict traversal depth fix**: `_is_claude_hook_installed()` was checking `hook.get("command")` at the top-level entry dict (which only has `matcher` and `hooks` keys). Fixed to traverse the nested structure `entry["hooks"][h]["command"]` matching the actual `.claude/settings.json` format.

3. **Return value fix**: `get_hooks_enabled()` previously always returned `True` (even in the `else` branch). Now correctly returns `False` when config output is `"false"`.

## Tasks Completed

1. **Fix get_hooks_enabled() and set_hooks_enabled() CLI flag syntax** — Changed `--get` to positional `get` subcommand; changed `--set key=value` to positional `set key value` subcommand. Fixed `get_hooks_enabled()` to return `False` when stdout is `"false"`, instead of always returning `True`.

2. **Fix _is_claude_hook_installed() dict traversal depth** — Changed single-level loop `for hook in settings["hooks"]["Stop"]` with `hook.get("command")` to two-level traversal: outer loop over `entry` objects (with `matcher`/`hooks` keys), inner loop over `entry.get("hooks", [])` checking `h.get("command")`.

## Self-Check: PASSED

- No `--get` or `--set` flag strings remain in manager.py
- `get_hooks_enabled()` calls `[_GRAPHITI_CLI, "config", "get", "hooks.enabled"]`
- `set_hooks_enabled()` calls `[_GRAPHITI_CLI, "config", "set", "hooks.enabled", str(enabled).lower()]`
- `get_hooks_enabled()` returns `False` when config output is `"false"`
- `_is_claude_hook_installed()` uses two-level traversal matching actual settings.json structure
- No `hook.get("command", "")` at top-level entry dict remains
- Structlog used correctly (manager.py is not in mcp_server/)
