---
plan: 8.7-02
phase: 8.7-gap-closure-hook-security-gaps-inserted
title: Wire install_precommit_hook into CLI install/uninstall/status
status: pending
created: 2026-02-27
---

# Plan 8.7-02: Wire install_precommit_hook into CLI Commands

## Objective

`install_precommit_hook()` exists in `src/hooks/installer.py:478` but is never called
from the CLI. Make `graphiti hooks install` deploy all 5 hooks, and update uninstall +
status to match.

## Root Cause

`src/cli/commands/hooks.py` `install_command()` calls:
- `install_hooks()` → post-commit + Claude Code
- `upgrade_postmerge_hook()` → post-merge
- `install_postcheckout_hook()` → post-checkout
- `install_postrewrite_hook()` → post-rewrite

But **`install_precommit_hook()`** is never called. The template
(`src/hooks/templates/pre-commit.sh`) and installer function (`installer.py:478`) both
exist — they're just not wired.

## Files to Change

| File | What to change |
|------|---------------|
| `src/cli/commands/hooks.py` | `install_command`: call `install_precommit_hook(git_dir)` |
| `src/cli/commands/hooks.py` | `uninstall_command`: call `uninstall_precommit_hook(git_dir)` |
| `src/cli/commands/hooks.py` | `status_command`: check `is_precommit_hook_installed(git_dir)` and add row to status table |

## Required Imports

`src/hooks/installer.py` already exports:
- `install_precommit_hook(repo_path: Path, force: bool = False) -> bool`
- `uninstall_precommit_hook(repo_path: Path) -> bool`
- `is_git_hook_installed(repo_path: Path) -> bool` — checks post-commit
  (no dedicated `is_precommit_hook_installed` exists — need to check if one exists or
  implement the check inline as `(git_dir / "hooks" / "pre-commit").exists()` with
  marker check)

Check `installer.py` to see if `is_precommit_hook_installed` or similar exists; if not,
check for the GRAPHITI_HOOK_START marker directly.

## Tasks

1. Read `src/hooks/installer.py` around lines 478–545 — find `install_precommit_hook`,
   `uninstall_precommit_hook`, and any status-check function for pre-commit
2. Read `src/cli/commands/hooks.py` fully — understand install/uninstall/status structure
3. In `install_command()`: add `install_precommit_hook(git_dir)` call after the other
   hook installs; update success messaging to mention pre-commit
4. In `uninstall_command()`: add `uninstall_precommit_hook(git_dir)` call; report removal
5. In `status_command()`: add a "Git pre-commit" row to the status table
6. Add `install_precommit_hook`, `uninstall_precommit_hook` to imports in hooks.py
7. Run `pytest tests/ -x -q` to confirm no regressions

## Verification

```bash
# Install and check all 5 hooks present
.venv/bin/graphiti hooks install
ls -la .git/hooks/{post-commit,pre-commit,post-merge,post-checkout,post-rewrite}
# All 5 should exist and be executable

# Check status shows pre-commit
.venv/bin/graphiti hooks status
# Should show "Git pre-commit ✓"

# Uninstall and check pre-commit removed
.venv/bin/graphiti hooks uninstall --git-only
ls .git/hooks/pre-commit 2>/dev/null && echo "still there" || echo "removed"
# Should print "removed"
```

## Commit Message

```
fix(hooks): wire install_precommit_hook into CLI install/uninstall/status

graphiti hooks install now deploys all 5 hooks: post-commit, pre-commit,
post-merge, post-checkout, post-rewrite. Uninstall and status updated to match.
```
