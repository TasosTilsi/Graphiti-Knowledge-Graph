---
phase: 8.7-gap-closure-hook-security-gaps-inserted
plan: "03"
subsystem: testing
tags: [verification, hooks, git, security, pre-commit, scan-staged-secrets]

# Dependency graph
requires:
  - phase: 8.7-gap-closure-hook-security-gaps-inserted
    provides: "8.7-01 fixed scan_staged_secrets to scan new staged files; 8.7-02 wired pre-commit hook into graphiti hooks install"
provides:
  - "verify_phase_07.py Test 2 now verifies brand-new staged files are scanned for secrets (8.7-01 fix)"
  - "verify_phase_71.py Tests 1+2 now verify all 5 hooks (including pre-commit) are installed by graphiti hooks install (8.7-02 fix)"
affects: ["phase-09", "phase-10", "any future verification runs"]

# Tech tracking
tech-stack:
  added: []
  patterns: ["Verification scripts must be updated after fixing bugs to directly assert correct behaviour"]

key-files:
  created: []
  modified:
    - scripts/verify_phase_07.py
    - scripts/verify_phase_71.py

key-decisions:
  - "Commit clean version before new-file sub-test so index is in known state — prevents false positives from leftover staged changes"
  - "Remove old limitation comment rather than update it — comment documenting a bug is noise once the bug is fixed"
  - "pre-commit listed first in auto_installed_hooks list — secret-scanning is primary security gate, ordering emphasises importance"

patterns-established:
  - "Verification scripts mirror the fixes they test: when a bug is fixed, the corresponding verification sub-test asserts the fixed behaviour"
  - "Use r.ok()/r.fail() with descriptive strings that name the commit that introduced the fix for easy cross-reference"

requirements-completed: []

# Metrics
duration: 2min
completed: 2026-02-27
---

# Phase 8.7 Plan 03: Update Verification Scripts for Fixed Behaviour Summary

**Verification scripts for Phase 07 and 7.1 updated to directly test the 8.7-01 (new-file scan) and 8.7-02 (5-hook deploy) fixes instead of working around the bugs**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-27T16:30:42Z
- **Completed:** 2026-02-27T16:31:48Z
- **Tasks:** 5 (read + edit x2 scripts + run x2)
- **Files modified:** 2

## Accomplishments

- `verify_phase_07.py` Test 2 now includes a sub-test for brand-new staged files — confirms scan_staged_secrets catches secrets in files that have no HEAD history (8.7-01 fix). Removed the old "known limitation" comment that explained why it was not tested.
- `verify_phase_71.py` Tests 1 & 2 now expect all 5 hooks (`pre-commit`, `post-commit`, `post-merge`, `post-checkout`, `post-rewrite`) to be deployed by `graphiti hooks install`. Removed the pre-commit special-case block that documented it as not auto-installed.
- Both scripts pass with 0 failures (verify_phase_07.py: 19 passed, verify_phase_71.py: 16 passed, 1 skipped due to --skip-ollama).

## Task Commits

Each task was committed atomically:

1. **Tasks 1-5: Edit verify_phase_07.py + verify_phase_71.py + run both** - `3da319a` (test)

**Plan metadata:** (final doc commit follows)

## Files Created/Modified

- `scripts/verify_phase_07.py` — Removed 4-line "known limitation" comment in Test 2; added 8-line sub-test that stages a brand-new file with a fake AWS key and asserts scan_staged_secrets detects it
- `scripts/verify_phase_71.py` — Changed `auto_installed_hooks` from 4 entries to 5 (added `"pre-commit"`); removed 10-line special-case block for pre-commit not being auto-installed

## Decisions Made

- Committed clean version of `config.py` before the new-file sub-test so the git index is in a known clean state. Without this, the previous staged clean file would still be in the index and could confuse the diff.
- Removed the limitation comment entirely rather than changing "known limitation" to "was a limitation — now fixed". A comment documenting a bug that no longer exists is noise.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Phase 8.7 gap closure complete: all 3 plans done (8.7-01 fix scan_staged_secrets, 8.7-02 wire pre-commit hook, 8.7-03 update verify scripts)
- Verification scripts now accurately reflect the fixed behaviour — safe to use for future verification runs
- Phase 9 (Frontend UI / next milestone phase) is the next planned work

---
*Phase: 8.7-gap-closure-hook-security-gaps-inserted*
*Completed: 2026-02-27*
